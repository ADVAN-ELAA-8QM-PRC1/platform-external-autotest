# Copyright (c) 2013 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

AUTHOR = 'The Chromium OS Authors,chromeos-video@google.com'
NAME = 'audiovideo_Formats'
PURPOSE = 'Verify formats availability for hardware offload.'
CRITERIA = """
This test will fail if reported supported formats are different from expected.
For example, daisy should support hardware VP8 and H264 decode.

This control file for Daisy/Snow.
"""
SUITE = 'video'
TIME='FAST'
TEST_CATEGORY = 'Functional'
TEST_CLASS = 'audiovideo'
TEST_TYPE = 'client'
DEPENDENCIES = 'board:daisy'

DOC = """
V4L2 formats enumeration is done in C. It is built as a extension module
(v4l2.so) during setup.
"""

DAISY_VIDEO_DEC = "/dev/mfc-dec"

# If the constraint fails, the following message will appear:
#  FAIL: iteration 0:...: constraint was not met
#
# If the constraint keyval is not found, this message will appear instead:
#  FAIL: iteration 0:could not evaluate constraint: ...
constraints = ['cap_fmt_VM12 == True',
               'cap_fmt_NM12 == True',
               'out_fmt_H264 == True',
               'out_fmt_VP80 == True']

job.run_test('audiovideo_Formats', video_device=DAISY_VIDEO_DEC,
             constraints=constraints)

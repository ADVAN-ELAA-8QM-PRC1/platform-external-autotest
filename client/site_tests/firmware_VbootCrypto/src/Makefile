# Copyright (c) 2010 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

VBOOT_REFERENCE_DIR = $(GCLIENT_ROOT)/src/platform/vboot_reference
BUILD_TEST_DIR = vboot_reference
# Test Binaries.
TEST_BINS = sha_tests testcases testkeys rsa_padding_test run_rsa_tests.sh \
	sha_benchmark rsa_verify_benchmark
# Utility Binaries.
UTIL_BINS = verify_data signature_digest

all: 
        # Copy test sources into a temporary directory for building.
	rm -rf $(BUILD_TEST_DIR)
	cp -r $(VBOOT_REFERENCE_DIR) .
        # Always build from scratch.
	$(MAKE) -C $(BUILD_TEST_DIR) clean all
        # Move test binaries for use by the tests.
	mkdir tests
	for i in $(TEST_BINS); do \
	  ( mv $(BUILD_TEST_DIR)/tests/$$i tests/ ) ;\
	done
        # Move utility binaries used by the tests.
	mkdir utils
	for i in $(UTIL_BINS); do \
	  ( mv $(BUILD_TEST_DIR)/utils/$$i utils/ ) ;\
	done
        # Delete sources.
	rm -rf $(BUILD_TEST_DIR)

clean:
	rm -rf utils/ tests/

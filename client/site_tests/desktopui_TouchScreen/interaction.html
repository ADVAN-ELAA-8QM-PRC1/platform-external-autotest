<html>
  <head>
    <title>TouchScreen Test</title>
    <style>
      #info {
        position: fixed;
        background-color: cyan;
      }
      #posts {
        position: fixed;
        background-color: magenta;
        left: 35em;
      }
      #ipsum {
        width: 60%;
        position: absolute;
        right: 1em;
      }

    </style>
    <script>
      function replacer(key, val){
        //replacer for JSON.stringify. To avoid serializing complex objects in the event.
        if (key == "") //this is the root object, we want it
                 return(val);
        if(typeof val == 'object')
          return('obj');
        return(val);
      }

      function event2json(e){
        event_json = JSON.stringify(e, replacer, '    ');
        return(event_json);
      }

      function display_event(e) {
        info_div = document.getElementById("info");
        info_div.innerHTML = event2json(e);
      }

      function display_short(e) {
        info_div = document.getElementById("info");
        info_div.innerHTML += e.type + '\n';
      }

      function report_event_short(e) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/interaction/test", false);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onreadystatechange = update_callback;
        xhr.send('event=happaned&type=' + e.type);
      }

      function report_event_json(e) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/interaction/test", false);
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
        xhr.onreadystatechange = update_callback;
        xhr.send(event2json(e));
      }

      function update_callback(xhr) {
        if (xhr.readyState != 4)
          return;
        post_div = document.getElementById("posts");
        post_div.innerHTML = xhr.responseText;
      }

      function event_handler(e) {
        //display_event(e);
        display_short(e);
        report_event_short(e);
      }

      function on_load() {
        // See the W3C draft on touch events
        // http://www.w3.org/TR/touch-events/
        // And this test page for examples
        // http://www.quirksmode.org/m/tests/touch.html
        event_list = [
          'click',
          'touchstart',
          'scroll'
        ];
        for (var i = 0; i < event_list.length; i++)
          document.addEventListener(event_list[i], event_handler, false);
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/interaction/onload", false);
        xhr.send(null);
      }
    </script>
  </head>

  <body onload="on_load();">
    <input type="button" id="btn"i value="button"/>
    <pre id="info"></pre>
    <pre id="posts"></pre>
    <div id="ipsum">
      <p>1. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      <p>2. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      <p>3. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      <p>4. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      <p>5. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      <p>6. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      <p>7. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      <p>8. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      <p>9. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
    </div>
  </body>
</html>

# Copyright (c) 2012 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# Purpose: This test case verifies that bgscan aborts and/or backs off when
# there is consistent outgoing traffic.
{ "name":"BG_Scan_With_Outgoing_Traffic",
  "steps":[
    [ "create",                { "type":"hostap" } ],
    [ "config",                { "channel":"2412", "mode":"11g" } ],

    [ "bgscan_set",            { "short_interval":"7",
                                 "long_interval":"7",
                                 "method":"simple"} ],
    # Spend 10 seconds pinging, bgscan will hit somewhere in there.
    [ "connect",               { "security":"none" } ],
    [ "client_ping_bg",        { "interval":".1" } ],
    [ "sleep"         ,        { "time":"10" } ],
    [ "client_ping_bg_stop" ,  { "save_stats":"with_bgscan" } ],
    [ "disconnect" ],
    # No bgscan in here, but take 10 seconds to get some reasonable statistics.
    [ "bgscan_disable" ],
    [ "connect",               { "security":"none" } ],
    [ "client_ping_bg",        { "interval":".1" } ],
    [ "sleep"         ,        { "time":"7" } ],
    [ "client_ping_bg_stop" ,  { "save_stats":"no_bgscan" } ],
    [ "disconnect" ],

    [ "assert_ping_similarity", { "stats0":"with_bgscan",
                                  "stats1":"no_bgscan" } ],

    [ "deconfig" ],
    [ "destroy" ],
  ],
}

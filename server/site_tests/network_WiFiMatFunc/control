# Copyright (c) 2010 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

AUTHOR = "Sam Leffler <sleffler@google.com>"
TIME = "LONG"
NAME = "WiFi MatFunc"
TEST_CATEGORY = "Stress"
TEST_CLASS = "network"
TEST_TYPE = "Server"
SYNC_COUNT = 1
DOC = """
WiFiMatFunc is a suite of 3-machine tests to validate basic WiFi functionality.
One client, one server, and one programmable WiFi AP/Router are required
(either off-the-shelf with a network-accesible CLI or a Linux/BSD system
with a WiFi card that supports HostAP functionality).

Configuration information to run_test:

server     - the IP address of the server (automatically filled in)
client     - the IP address of the client (automatically filled in)
router     - the IP address of the WiFi AP/Router and the names of the
             wifi and wired devices to configure
"""

from autotest_lib.server import site_wifitest

import os

# convert autoserv args to something usable
opts = dict([[k, v] for (k, e, v) in [x.partition('=') for x in args]])

config_file = opts.get('config_file', 'wifi_testbed_config')
test_pat = opts.get('test_pat', '[0-9]*')

config = site_wifitest.read_wifi_testbed_config(
    os.path.join(job.configdir, config_file),
    client_addr = machines[0])    # NB: take client identity from command line

server = config['server']
router = config['router']

logging.info("Client %s, Server %s, AP %s" % \
    (machines[0], server.get('addr', 'N/A'), router['addr']))

dir = os.path.join(job.serverdir, "site_tests", "network_WiFiMatFunc")

for t in site_wifitest.read_tests(dir, test_pat):
   job.run_test("network_WiFiMatFunc", testcase=t, config=config, tag=t['file'])

# Copyright (c) 2012 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.
#
# Test expects to be run on a jailbroken device in developer mode.

from autotest_lib.server import utils

AUTHOR = "Chrome OS Team"
NAME = "platform_ServoPyAuto"
PURPOSE = "Servo and PyAuto based ChromeOS functional test."
CRITERIA = "Fails if login is not persistent across a lid-close induced sleep."
TIME = "LONG"
TEST_CATEGORY = "Functional"
TEST_CLASS = "platform"
TEST_TYPE = "server"

DOC = """
This test uses PyAuto to login and Servo to close the lid switch. Servo is used
to wake the device by opening the lid switch. PyAuto is used to verify that the
user is still logged in.
"""

args_dict = utils.args_to_dict(args)
servo_host = args_dict.get('servo_host', 'localhost')
servo_port = args_dict.get('servo_port', None)

def run(machine):
    host = hosts.create_host(machine, servo_host=servo_host,
                             servo_port=servo_port)
    job.run_test("platform_ServoPyAuto", host=host, disable_sysinfo=True)

parallel_simple(run, machines)

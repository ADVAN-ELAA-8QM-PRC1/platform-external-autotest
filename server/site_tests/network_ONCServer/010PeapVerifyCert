# Copyright (c) 2012 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.
# Test to check 802.1x PEAP network connection with CA authentication

{ "name":"010PeapVerifyCert",

  "steps":[
    [ "create",         { "type":"hostap" } ],
    [ "install_files",  { "system" : "router",
                          "files" :
                            { "/tmp/hostapd_ca_cert" :
                                site_eap_certs.ca_cert_1,
                              "/tmp/hostapd_server_cert" :
                                site_eap_certs.server_cert_1,
                              "/tmp/hostapd_private_key" :
                                site_eap_certs.server_private_key_1,
                              "/tmp/hostapd_eap_user_file" :
                                """* PEAP
"testuser-chapv2" MSCHAPV2 "password" [2]
"testuser-md5" MD5 "password" [2]""" } } ],
    [ "config",          { "ssid":"010PeapVerifyCert",
                           "channel":"2412", "mode":"11g",
                           "wpa":"1", "wpa_key_mgmt":"WPA-EAP",
                           "eap_server" : "1",
                           "wpa_pairwise":"CCMP", "ieee8021x":"1",
                           "ca_cert" : "/tmp/hostapd_ca_cert",
                           "server_cert" : "/tmp/hostapd_server_cert",
                           "private_key" : "/tmp/hostapd_private_key",
                           "eap_user_file" : "/tmp/hostapd_eap_user_file"} ],
    [ "set_user_onc",
            { "onc":
                     """{
                          "NetworkConfigurations": [
                           {
                            "GUID": "{e9653da3-2d0c-c18f-026450ccab4d5e98}",
                            "Name": "010PeapVerifyCert",
                            "Type": "WiFi",
                            "WiFi": {
                                     "AutoConnect": true,
                                     "HiddenSSID": false,
                                     "Security": "WPA-EAP",
                                     "SSID": "010PeapVerifyCert",
                                     "EAP": {
                                             "Outer": "PEAP",
                                             "UseSystemCAs": true,
                                             "SaveCredentials": true,
                                             "Identity": "testuser-chapv2",
                                             "Password": "password",
                                             "ServerCARef": "{42cb13cd-140c-4941-9fb6-0824ea2fde17}"
                                            }
                                    },
                            "ProxySettings": {
                                              "Type": "Direct"
                                             }
                           }
                                                   ],
                            "Certificates": [
                             {
                               "GUID": "{42cb13cd-140c-4941-9fb6-0824ea2fde17}",
                               "Trust": [  ],
                               "Type": "Authority",
                               "X509": "-----BEGIN CERTIFICATE-----
MIIDRjCCAq+gAwIBAgIJANn/MIB1esFIMA0GCSqGSIb3DQEBBQUAMG8xCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MTMwMQYDVQQDEypjaHJvbWVsYWItd2lmaS10ZXN0YmVkLXJvb3QubXR2Lmdvb2dsZS5jb20wHhcNMTIwNDI2MDE0OTMxWhcNMjIwNDI0MDE0OTMxWjBvMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEzMDEGA1UEAxMqY2hyb21lbGFiLXdpZmktdGVzdGJlZC1yb290Lm10di5nb29nbGUuY29tMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC7ih4cIp4P5aRu8ydFu0ggXr0gVLEdIMbHg3hfPjluDzNhbAP400+Vg0zJgfyOJCE8I6qzKMIX4MGDEKBGADmB68gffQiwkVGr7IwzeR7Qmy5j1M0Ks6HS1V0wLPgDBSnf8HtqRuHU63V43mpiW8DltXSbO1QmgtDHLIHhIPukTwIDAQABo4HpMIHmMB0GA1UdDgQWBBQyZyGNkYvK49JfViPq6cqz+ayUPzCBoQYDVR0jBIGZMIGWgBQyZyGNkYvK49JfViPq6cqz+ayUP6FzpHEwbzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxMzAxBgNVBAMTKmNocm9tZWxhYi13aWZpLXRlc3RiZWQtcm9vdC5tdHYuZ29vZ2xlLmNvbYIJANn/MIB1esFIMAwGA1UdEwQFMAMBAf8wEwYDVR0lBAwwCgYIKwYBBQUHAwMwDQYJKoZIhvcNAQEFBQADgYEACy7WcGIZNfpnIrdM0TpzYrqkzNEdrdvO32mX4WKrpF2YdhNQ6NMqLJEHjq4iTwMMf1oxUT+XR2fZba/umMvP8s2RASNKzmozw0GRuK8wzsFYjC/85TwL3Z6d2nzgpBjVtpE5kROYb6ZSoIDgYwTUgvLrROpy4Uc68PrGnFcCvCE=
-----END CERTIFICATE-----"
                             },],
                             "Type": "UnencryptedConfiguration"
                        }"""
            } ],
    [ "connect_wifi_onc" ],
    [ "client_ping", { "count":"10"} ],
    [ "client_logout" ],
    [ "destroy" ],
  ],
}

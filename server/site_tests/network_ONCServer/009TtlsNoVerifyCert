# Copyright (c) 2012 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# Try 802.1x authentication.

{ "name":"009TtlsNoCert",
  "steps":[
    [ "create",         { "type":"hostap" } ],
    [ "install_files",  { "system" : "router",
                          "files" :
                            { "/tmp/hostapd_ca_cert" :
                                site_eap_certs.ca_cert_1,
                              "/tmp/hostapd_server_cert" :
                                site_eap_certs.server_cert_1,
                              "/tmp/hostapd_private_key" :
                                site_eap_certs.server_private_key_1,
                              "/tmp/hostapd_eap_user_file" :
                                """* TTLS
"testuser-chapv2" MSCHAPV2 "password" [2]
"testuser-md5" MD5 "password" [2]""" } } ],
    [ "config",         { "ssid":"009TtlsNoCert",
                          "channel":"2412", "mode":"11g",
                          "wpa":"1", "wpa_key_mgmt":"WPA-EAP",
                          "eap_server" : "1",
                          "wpa_pairwise":"CCMP", "ieee8021x":"1",
                          "ca_cert" : "/tmp/hostapd_ca_cert",
                          "server_cert" : "/tmp/hostapd_server_cert",
                          "private_key" : "/tmp/hostapd_private_key",
                          "eap_user_file" : "/tmp/hostapd_eap_user_file"} ],
    [ "set_user_onc",
            { "onc":
                     """{
                          "NetworkConfigurations": [
                           {
                             "GUID": "{e9653da3-2d0c-c18f-026450ccab4d5e98}",
                             "Name": "009TtlsNoCert",
                             "Type": "WiFi",
                             "WiFi": {
                                      "AutoConnect": true,
                                      "HiddenSSID": false,
                                      "Security": "WPA-EAP",
                                      "SSID": "009TtlsNoCert",
                                      "EAP": {
                                      "Outer": "EAP-TTLS",
                                      "Inner": "Automatic",
                                      "UseSystemCAs": false,
                                      "SaveCredentials": true,
                                      "Identity": "testuser-chapv2",
                                      "Password": "password"
                                             }
                                     },
                             "ProxySettings": {
                             "Type": "Direct"
                             }
                      }
            ],
                          "Certificates": [],
                          "Type": "UnencryptedConfiguration"
                          }"""
            } ],
    [ "connect_wifi_onc" ],
    [ "client_ping", { "count":"10"} ],
    [ "client_logout" ],
    [ "destroy" ],
  ],
}
